<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/">
  <head>
    <title>Universal Looking Glass</title>
    <py:if test="defined('refresh')">
      <meta http-equiv="refresh" content="$refresh" py:if="defined('refresh') and (refresh>0)" />
    </py:if>

    <script type="text/javascript">
      function updateFormParams()
      {
        var rs=document.getElementById("routerselect");
        var cs=document.getElementById("commandselect");

      <py:for each="ridx,router in enumerate(routers)">
	<py:for each="cidx,cmd in enumerate(routers[ridx].listCommands())">
<![CDATA[        if((rs.options[rs.selectedIndex].value==$ridx) && (cs.options[cs.selectedIndex].value==$cidx)) { ]]>
	  <py:choose>
	    <py:when test="routers[ridx].listCommands()[cidx].getParamSpec() and (routers[ridx].listCommands()[cidx].getParamSpec().getType() == 'text')">
	      document.getElementById("paramrow").innerHTML='                                                                           \
	      <th align="left">                                                                                                         \
		<label for="param">3. ${routers[ridx].listCommands()[cidx].getParamSpec().getName()}:</label>                           \
	      </th>                                                                                                                     \
	      <td align="left">                                                                                                         \
		<input type="text" id="param1" name="param1" value="${routers[ridx].listCommands()[cidx].getParamSpec().getDefault()}" /></td>';
	    </py:when>
	    <py:otherwise>
          document.getElementById("paramrow").innerHTML='';
	    </py:otherwise>
	  </py:choose>
	}
	</py:for>
      </py:for>
      }

      function updateFormCommands()
      {
        var rs=document.getElementById("routerselect");
      <py:for each="ridx,router in enumerate(routers)">
	if(rs.options[rs.selectedIndex].value==$ridx) {
	  document.getElementById("commandselect").innerHTML='<py:for each="cidx,cmd in enumerate(routers[ridx].listCommands())"><py:choose><py:when test="cidx == default_command"><option value="$cidx" selected="selected">${cmd.getName()}</option></py:when><py:otherwise><option value="$cidx">${cmd.getName()}</option></py:otherwise></py:choose></py:for>';
	}
      </py:for>

        updateFormParams()
      }
    </script>

  </head>
  <body class="index">
    <script>
      window.onload=updateFormCommands; 
    </script>
    <div id="header">
      <py:choose>
	<py:when test="defaults.header">
	  <h1>ULG - $defaults.header</h1>
	</py:when>
	<py:otherwise>
	  <h1>ULG</h1>
	</py:otherwise>
      </py:choose>
    </div>
    <p>Select router to perform operation on, then select a command to perform and add (optional) argument if needed.</p>
    <form action="runcommand" method="post">
      <input type="hidden" name="session" value="$default_session" py:if="defined('default_session') and (default_session)" />
      <table summary="Form settings">
	<tbody>
	  <tr>
            <th align="left"><label for="router">1. Router selection:</label></th>
	    <td>
	      <select id="routerselect" name="router" onchange="updateFormCommands()">
		<py:for each="ridx,rtr in enumerate(routers)">
		  <py:choose>
		    <py:when test="ridx == default_router">
		      <option value="$ridx" selected="selected">
			${rtr.getName()}
		      </option>
		    </py:when>
		    <py:otherwise>
		      <option value="$ridx">
			${rtr.getName()}
		      </option>
		    </py:otherwise>
		  </py:choose>
		</py:for>
	      </select>
            </td>
	  </tr>
	  <tr height="10">
	  </tr>
	  <tr>
	    <th align="left" valign="top">2. Command selection:</th>
	    <td align="left">
	      <select id="commandselect" name="command" onchange="updateFormParams()">
		<py:for each="cidx,cmd in enumerate(routers[default_router].listCommands())">
		  <py:choose>
		    <py:when test="cidx == default_command">
		      <option value="$cidx" selected="selected">
			${cmd.getName()}
		      </option>
		    </py:when>
		    <py:otherwise>
		      <option value="$cidx">
			${cmd.getName()}
		      </option>
		    </py:otherwise>
		  </py:choose>
		</py:for>
	      </select>
	    </td>
	  </tr>
	  <tr height="10"></tr>
	  <tr id="paramrow">
	  </tr>
	  <tr>
            <td></td>
            <td>
              <input type="submit" value="Submit" />
            </td>
	  </tr>
	</tbody>
      </table>
    </form>
    <div id="result">
      <hr/>
      <py:choose>
	<py:when test="defined('result')">
	  ${result}
	</py:when>
	<py:otherwise>
	  <em>No result.</em>
	</py:otherwise>
      </py:choose>
      <p py:if="defined('refresh') and (refresh>0)">
	<em>Refreshing in $refresh seconds.</em>
      </p>
    </div>
    <div id="footer">
      <hr/>
      <p class="legalese" align="right"><small>Â© 2012 Tomas Hlavacek</small></p>
    </div>
  </body>
</html>

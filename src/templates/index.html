<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/">
  <head>
    <title>Universal Looking Glass</title>
    <link rel="stylesheet" href="ulg.css" />
    <py:if test="defined('refresh')">
      <meta http-equiv="refresh" content="$refresh" py:if="defined('refresh') and (refresh>0)" />
    </py:if>
    <script type="text/javascript" src="tinybox.js"></script>
    <script type="text/javascript">
      function updateFormParams()
      {
        var rs=document.getElementById("routerselect");
        var cs=document.getElementById("commandselect");

      <py:for each="ridx,router in enumerate(routers)">
	<py:for each="cidx,cmd in enumerate(routers[ridx].listCommands())">
<![CDATA[        if((rs.options[rs.selectedIndex].value==$ridx) && (cs.options[cs.selectedIndex].value==$cidx)) { ]]>

            document.getElementById("paramsect").innerHTML='                                                                            \
            <py:for each="pidx,param in enumerate(routers[ridx].listCommands()[cidx].getParamSpecs())">
	      <tr height="10"></tr>                                                                                                     \
	      <tr>                                                                                                                      \
		<th align="left">                                                                                                       \
		  ${pidx+3}. ${param.getName()}:                                                                                        \
		</th>                                                                                                                   \
		<py:choose>
		  <py:when test="param.getType() == 'select'">
		    <td align="left">                                                                                                   \
		      <select name="param${pidx}">                                                                                      \
			<py:for each="paridx,partuple in enumerate(param.getOptions())">
			  <py:choose>
			    <py:when test="default_routerid == ridx and default_commandid == cidx and defined('default_params') and partuple[0] == default_params[pidx]">
			      <option value="${partuple[0]}" selected="selected">                                                       \
				${partuple[1]}                                                                                          \
			      </option>                                                                                                 \
			    </py:when>
			    <py:when test="partuple[0] == param.getDefault()">
			      <option value="${partuple[0]}" selected="selected">                                                       \
				${partuple[1]}                                                                                          \
			      </option>                                                                                                 \
			    </py:when>
			    <py:otherwise>
			      <option value="${partuple[0]}">                                                                           \
				${partuple[1]}                                                                                          \
			      </option>                                                                                                 \
			    </py:otherwise>
			  </py:choose>
			</py:for>
		      </select>                                                                                                         \
		    </td>                                                                                                               \
		  </py:when>
		  <py:otherwise>
		    <td align="left">                                                                                                   \
		      <py:choose>
			<py:when test="default_routerid == ridx and default_commandid == cidx and defined('default_params') and pidx &lt; len(default_params)">
			  <input type="text" name="param${pidx}" value="${default_params[pidx]}" />                                     \
			</py:when>
			<py:otherwise>
			  <input type="text" name="param${pidx}" value="${param.getDefault()}" />                                       \
			</py:otherwise>
		      </py:choose>
		    </td>                                                                                                               \
		  </py:otherwise>
		</py:choose>
	      </tr>                                                                                                                     \
	    </py:for>';
	    }
	</py:for>
      </py:for>
      }

      function updateFormCommands()
      {
        var rs=document.getElementById("routerselect");
      <py:for each="ridx,router in enumerate(routers)">
	if(rs.options[rs.selectedIndex].value==$ridx) {
	document.getElementById("commandselect").innerHTML='                                                                            \
	<py:for each="cidx,cmd in enumerate(routers[ridx].listCommands())">
	  <py:choose>
	    <py:when test="default_routerid == ridx and default_commandid == cidx">
	      <option value="$cidx" selected="selected">${cmd.getName()}</option>                                                       \
	    </py:when>
	    <py:otherwise>
	      <option value="$cidx">${cmd.getName()}</option>                                                                           \
	    </py:otherwise>
	  </py:choose>
	</py:for>';
	}
      </py:for>

        updateFormParams()
      }
    </script>

  </head>
  <body class="index">
    <script>
      window.onload=updateFormCommands; 
    </script>
    <div id="header">
      <py:choose>
	<py:when test="defaults.header">
	  <h1>ULG - $defaults.header</h1>
	</py:when>
	<py:otherwise>
	  <h1>ULG</h1>
	</py:otherwise>
      </py:choose>
    </div>
    <p>Select router to perform operation on, then select a command to perform and add (optional) argument if needed.</p>
    <form action="${getFormURL()}" method="post">
      <input type="hidden" name="sessionid" value="$default_sessionid" py:if="defined('default_sessionid') and (default_sessionid)" />
      <input type="hidden" name="resrange" value="$resrange" py:if="defined('resrange')" />
      <table summary="Form settings">
	<tbody>
	  <tr>
            <th align="left">1. Router selection:</th>
	    <td>
	      <select id="routerselect" name="routerid" onchange="updateFormCommands()">
		<py:for each="ridx,rtr in enumerate(routers)">
		  <py:choose>
		    <py:when test="ridx == default_routerid">
		      <option value="$ridx" selected="selected">
			${rtr.getName()}
		      </option>
		    </py:when>
		    <py:otherwise>
		      <option value="$ridx">
			${rtr.getName()}
		      </option>
		    </py:otherwise>
		  </py:choose>
		</py:for>
	      </select>
            </td>
	  </tr>
	  <tr height="10"></tr>
	  <tr>
	    <th align="left" valign="top">2. Command selection:</th>
	    <td align="left">
	      <select id="commandselect" name="commandid" onchange="updateFormParams()">
	      </select>
	    </td>
	  </tr>
	</tbody>
	<tbody id="paramsect">
	</tbody>
	<tbody>
	  <tr height="10"></tr>
	  <tr>
            <th><br/></th>
            <td>
              <input type="submit" value="Submit" />
            </td>
	  </tr>
	</tbody>
      </table>
    </form>
    <py:choose>
      <py:when test="defined('result') or defined('refresh')">
	<div id="result">
	  <hr/>
	  <py:choose>
	    <py:when test="defined('result') and result">
	      ${result}
	    </py:when>
	    <py:otherwise>
	    </py:otherwise>
	  </py:choose>
	  <p py:if="defined('refresh') and (refresh>0)">
	    <em>Please wait for data from the router...</em><br/>
	    <em>The page is going to be refreshed in $refresh seconds.</em>
	  </p>
	</div>
	<div id="range">
	  <py:if test="defined('resrangeb') and resrangeb">
	    <br/>
	    <p> [
	      <py:for each="rb in resrangeb[:-1]">
		<py:choose>
		  <py:when test="rb[1]">
		    <a href="${rb[1]}">${rb[0]}</a> | 
		  </py:when>
		  <py:otherwise>
		    ${rb[0]} | 
		  </py:otherwise>
		</py:choose>
	      </py:for>
	      <py:choose>
		<py:when test="resrangeb[-1][1]">
		  <a href="${resrangeb[-1][1]}">${resrangeb[-1][0]}</a> ]
		</py:when>
		<py:otherwise>
		  ${resrangeb[-1][0]} ]
		</py:otherwise>
	      </py:choose>
	    </p>
	  </py:if>
	</div>
      </py:when>
    </py:choose>
    <div id="footer">
      <hr/>
      <p class="legales" align="right"><small>(c) 2012 Tomas Hlavacek</small></p>
    </div>
  </body>
</html>
